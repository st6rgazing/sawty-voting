# Sawty API Server

This is the API server for the Sawty Voting Platform, a secure e-voting system.

## Features

- Secure voter authentication using Secret IDs
- Email delivery of encrypted voting links
- Vote submission and verification
- Admin dashboard for monitoring votes
- MongoDB integration for data storage
- Fallback to local file storage if database is unavailable

## Setup

1. Clone this repository
2. Install dependencies:
   \`\`\`
   npm install
   \`\`\`
3. Create a `.env` file based on `.env.example`
4. Start the server:
   \`\`\`
   npm start
   \`\`\`

## Environment Variables

- `PORT`: The port the server will run on (default: 3000)
- `FRONTEND_URL`: URL of the frontend application
- `MONGODB_URI`: MongoDB connection string
- `EMAIL_USER`: Gmail account for sending emails
- `EMAIL_PASS`: Gmail app password
- `ENCRYPTION_KEY`: 32-character key for encryption
- `MAILING_LIST`: Comma-separated list of voter emails

## API Endpoints

### Authentication

- `POST /api/verify-secret`: Verify a Secret ID
- `POST /api/generate-secret`: Generate a Secret ID for a single voter
- `POST /api/generate-for-all`: Generate Secret IDs for all voters in the mailing list

### Voting

- `POST /api/submit-vote`: Submit a vote

### Admin

- `GET /api/admin/votes`: Get all votes
- `GET /api/admin/votes.json`: Get votes in JSON format
- `GET /api/voters`: Get all voters
- `GET /api/voters/:secretId`: Get a voter by Secret ID

## Importing Voters

To import voters from an Excel file:

1. Place an Excel file named `input.xlsx` in the `scripts` directory
2. The file should have columns: `Name`, `Type`, and `Email`
3. Run the import script:
   \`\`\`
   npm run import-voters
   \`\`\`

## Security

- All sensitive data is encrypted using AES-256-CBC
- Secret IDs are generated using cryptographically secure random bytes
- Emails contain encrypted tokens for secure login
\`\`\`

Let's also create a .gitignore file:

```text file=".gitignore"
# Dependencies
node_modules/
npm-debug.log
yarn-debug.log
yarn-error.log

# Environment variables
.env

# Data files
votes.json
scripts/input.xlsx

# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Dependency directories
jspm_packages/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env.local
.env.development.local
.env.test.local
.env.production.local

# Mac files
.DS_Store

# Windows files
Thumbs.db
ehthumbs.db
Desktop.ini
